(()=>{var e={577:function(e,t){var n,o;o=this,n=function(){return function(e){var t,n,o,r=r||void 0,i=(e=e||window).Postmonger,a=e.addEventListener||e.attachEvent?e:window;return(t=void 0!==r?r:{}).noConflict=function(){return e.Postmonger=i,this},t.version="0.0.14",n=t.Connection=function(e){var t=(e="object"==typeof e?e:{}).connect||a.parent,n=e.from||"*",o=e.to||"*",r=this;return"string"==typeof t&&(t=document.getElementById(t)),t&&!t.postMessage&&t.jquery&&(t=t.get(0)),t&&!t.postMessage&&(t.contentWindow||t.contentDocument)&&(t=t.contentWindow||t.contentDocument),t&&t.postMessage?(r.connect=t,r.to=o,r.from=n,r):(a.console&&a.console.warn&&a.console.warn(" Warning: Postmonger could not establish connection with ",e.connect),!1)},o=t.Events=function(){var e=/\s+/,t=this;return t._callbacks={},t._has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t._keys=function(e){if(Object.keys)return Object.keys(e);if("object"!=typeof e)throw new TypeError("Invalid object");var n=[];for(var o in e)t._has(e,o)&&(n[n.length]=o);return n},t.on=function(n,o,r){var i,a,s,c,l;if(!o)return t;for(n=n.split(e),t._callbacks=t._callbacks||{},i=t._callbacks;a=n.shift();)c={},(s=(l=i[a])?l.tail:{}).next=c,s.context=r,s.callback=o,i[a]={tail:c,next:l?l.next:s};return t},t.off=function(n,o,r){var i,a,s,c,l,u=t._callbacks;if(u){if(!(n||o||r))return delete t._callbacks,t;for(n=n?n.split(e):t._keys(u);i=n.shift();)if(a=u[i],delete u[i],a&&(o||r))for(s=a.tail;(a=a.next)!==s;)c=a.callback,l=a.context,(o&&c)===o&&(r&&l)===r||t.on(i,c,l);return t}},t.trigger=function(n){var o,r,i,a,s,c,l;if(!(i=t._callbacks))return t;for(c=i.all,n=n.split(e),l=Array.prototype.slice.call(arguments,1);o=n.shift();){if(r=i[o])for(a=r.tail;(r=r.next)!==a;)r.callback.apply(r.context||t,l);if(r=c)for(a=r.tail,s=[o].concat(l);(r=r.next)!==a;)r.callback.apply(r.context||t,s)}return t},t},t.Session=function(){var t,r,i,s,c,l,u=arguments.length>0?Array.prototype.slice.call(arguments,0):[{}],d=[],m=new o,f=new o,p=this;for(p.on=m.on,p.off=m.off,p.trigger=f.trigger,p.end=function(){return m.off(),f.off(),a.removeEventListener?a.removeEventListener("message",l,!1):a.detachEvent&&a.detachEvent("onmessage",l),p},r=0,s=u.length;r<s;r++)if(t=new n(u[r])){for(i=0,c=d.length;i<c;i++)if(d[i].connect===t.connect&&d[i].from===t.from&&d[i].to===t.to){t=null;break}t&&d.push(t)}if(l=function(t){var n,o,r,i=null,a=[];for(o=0,r=d.length;o<r;o++)if(d[o].connect===t.source){i=d[o];break}if(!i)return!1;if("*"!==i.from&&i.from!==t.origin)return!1;try{if(!(n=JSON.parse(t.data)).e)return!1}catch(e){return!1}for(o in a.push(n.e),delete n.e,n)a.push(n[o]);m.trigger.apply(e,a)},a.addEventListener)a.addEventListener("message",l,!1);else{if(!a.attachEvent)return a.console&&a.console.warn&&a.console.warn("WARNING: Postmonger could not listen for messages on window %o",a),!1;a.attachEvent("onmessage",l)}return f.on("all",function(){var e,t,n=Array.prototype.slice.call(arguments,0),o={};for(o.e=n[0],e=1,t=n.length;e<t;e++)o["a"+e]=n[e];for(e=0,t=d.length;e<t;e++)d[e].connect.postMessage(JSON.stringify(o),d[e].to)}),p},t}(o)}.apply(t,[]),void 0===n||(e.exports=n)}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(577);const t=new(n.n(e)().Session);let o=null,r=!1;const i="Hey {{Contact.Attribute.DE.FirstName}}, surprise! Enjoy 60% off on your next purchase with code WELCOME60.",a="{{Contact.Attribute.DE.Mobile}}",s="Sending immediately";let c={campaignName:"Adidas India – Welcome Offer",senderName:"Adidas India",messageTemplate:"promo",messageBody:i,mediaUrl:"https://images.unsplash.com/photo-1549880338-65ddcdfd017b",buttonLabel:"Shop Now",sendType:"immediate",sendSchedule:"",recipientTo:a};const l=e=>document.getElementById(e),u=["campaignName","messageBody","recipientTo"],d=["campaignName","senderName","messageTemplate","messageBody","mediaUrl","buttonLabel","sendType","sendSchedule","recipientTo"],m={templateLabel:"Seasonal promotion",campaignName:"Adidas India – Welcome Offer",senderName:"Adidas India",messageBody:i,sendTiming:s};let f=[],p=!1,g=!1;function y(e){l("done").disabled=!e}function v(){const e=(e="")=>e?.trim();return{campaignName:e(l("campaignName")?.value),senderName:e(l("senderName")?.value)||"",messageTemplate:l("messageTemplate")?.value||"promo",messageBody:l("messageBody")?.value||"",mediaUrl:e(l("mediaUrl")?.value)||"",buttonLabel:e(l("buttonLabel")?.value)||"",sendType:l("sendType")?.value||"immediate",sendSchedule:e(l("sendSchedule")?.value)||"",recipientTo:e(l("recipientTo")?.value)||""}}function h(e=v()){return!(!u.every(t=>{const n=e[t];return"string"==typeof n?n.trim().length>0:Boolean(n)})||"schedule"===e.sendType&&!e.sendSchedule)}const b=/({{\s*[^{}]+\s*}})/g;function T(e,{multiline:t=!1}={}){const n=function(e=""){return String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}(e);return(t?n.replace(/\r?\n/g,"<br />"):n).replace(b,'<span class="preview-token">$1</span>')}function A(e,t,n,o={}){const r=l(e);if(!r)return;const i=function(e){return"string"==typeof e?e.length>0:Boolean(e)}(t)?t:n;r.innerHTML=T(i||"",o)}function w(e=c){A("previewTemplateLabel",function(e){if(!e)return m.templateLabel;const{options:t,selectedIndex:n}=e;if("number"==typeof n&&n>=0){const e=t[n];if(e?.text)return e.text}const o=Array.from(t||[]).find(t=>t.value===e.value);return o?.text||m.templateLabel}(l("messageTemplate")),m.templateLabel),A("previewCampaign",e.campaignName,m.campaignName),A("previewSender",e.senderName,m.senderName),A("previewMessage",e.messageBody,m.messageBody,{multiline:!0}),function(e){const t=l("previewSendTiming");if(!t)return;const n=function(e){if("schedule"===e.sendType){if(!e.sendSchedule)return"Scheduled send (date required)";const t=e.sendSchedule;if(t.includes("{{"))return`Scheduled: ${t}`;const n=new Date(t);if(!Number.isNaN(n.getTime()))try{return`Scheduled: ${n.toLocaleString(void 0,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}`}catch{}return`Scheduled: ${t}`}return s}(e);t.textContent=n||m.sendTiming}(e),function(e){const t=l("previewMedia"),n=l("previewMediaImage");t&&n&&(e?(t.classList.add("visible"),n.src=e):(t.classList.remove("visible"),n.removeAttribute("src")))}(e.mediaUrl),function(e){const t=l("previewButton"),n=l("previewButtonText");t&&n&&(e?(t.hidden=!1,n.innerHTML=T(e)):(t.hidden=!0,n.textContent=""))}(e.buttonLabel)}function L(){const e=v();c={...e},function(e=v()){const t="schedule"===e.sendType,n=l("scheduleFields");n&&n.classList.toggle("visible",t)}(e),function(e=v()){const t=l("messageCounter");if(!t)return;const n=e.messageBody.length;t.textContent=`${n} / 1024 characters`}(e),w(e),y(h(e)),r||t.trigger("setActivityDirtyState",!0)}function E(e,t){const n=l(e);n&&("SELECT"===n.tagName?n.value=t||n.options[0]?.value:n.value=t||"","recipientTo"===e&&(p=Boolean(t)))}function S(e){o=e||{};const t=(o?.arguments?.execute?.inArguments||[]).reduce((e,t)=>Object.assign(e,t),{});r=!0,E("campaignName",t.campaignName),E("senderName",t.senderName),E("messageTemplate",t.messageTemplate),E("messageBody",t.messageBody),E("mediaUrl",t.mediaUrl),E("buttonLabel",t.buttonLabel),E("sendType",t.sendType||"immediate"),E("sendSchedule",t.sendSchedule),E("recipientTo",t.recipientTo||t.mobile||t.to),L();const n=h(c),i=!!(Object.keys(t||{}).length>0)&&h(t);y(n||o?.metaData?.isConfigured&&i),r=!1}function N(e){const t=[["campaignName",e.campaignName],["senderName",e.senderName],["messageTemplate",e.messageTemplate],["messageBody",e.messageBody],["mediaUrl",e.mediaUrl],["buttonLabel",e.buttonLabel],["sendType",e.sendType],["recipientTo",e.recipientTo]];return"schedule"===e.sendType&&e.sendSchedule&&t.push(["sendSchedule",e.sendSchedule]),t.filter(([,e])=>e).map(([e,t])=>({[e]:t}))}function k(e){f=function(e=[]){return(e||[]).map(e=>({key:e?.key,name:e?.name||e?.key?.split(".")?.slice(-1)?.[0],type:e?.type||""})).filter(e=>Boolean(e.key))}(e?.schema),function(){const e=l("recipientOptions");e&&(e.innerHTML="",f.forEach(t=>{const n=document.createElement("option");n.value=x(t.key),n.textContent=t.name?`${t.name} · ${n.value}`:n.value,e.appendChild(n)}))}(),function(){if(p)return;const e=function(){if(!f?.length)return a;const e=f.find(e=>function(e={}){const t=(e.type||"").toLowerCase();if(t.includes("phone")||t.includes("tel"))return!0;const n=`${e.key||""} ${e.name||""}`.toLowerCase();return n.includes("phone")||n.includes("mobile")||n.includes("whatsapp")}(e))||f[0];return e?x(e.key):a}();if(!e)return;const t=l("recipientTo")?.value;t?p=!0:(r=!0,E("recipientTo",e),L(),r=!1)}(),function(){if(g)return;const e=l("messageBody");if(!e)return;const t=e.value||"",n=C(t||i);if(n!==t){const e=r;r=!0,E("messageBody",n),L(),r=e}const o=C(m.messageBody);o!==m.messageBody&&(m.messageBody=o,w({...c,messageBody:o})),g=!0}()}function x(e){return e?e.startsWith("{{")?e:`{{${e}}}`:""}function B(e=""){return String(e||"").toLowerCase().replace(/[^a-z0-9]/g,"")}function C(e){if(!e||"string"!=typeof e)return e;if(!e.includes("Contact.Attribute.DE."))return e;const t=function(){const e=new Map;return f.forEach(t=>{const n=t?.key;if(!n)return;const o=x(n),r=B(n.split(".").slice(-1)[0]);r&&o&&(e.has(r)||e.set(r,o))}),e}();return 0===t.size?e:e.replace(/{{\s*Contact\.Attribute\.DE\.([^{}]+)\s*}}/gi,(e,n)=>{const o=B(n);return o&&t.get(o)||e})}function M(){const e={...c};if(!h(e))return void y(!1);const n={...o,arguments:{...o?.arguments,execute:{...o?.arguments?.execute,inArguments:N(e),outArguments:[]}},configurationArguments:{...o?.configurationArguments},metaData:{...o?.metaData,isConfigured:!0}},r=document.createElement("div");r.className="status-message success",r.innerHTML='\n    <div class="icon">✓</div>\n    <div class="message">Configuration saved successfully!</div>\n  ',document.body.appendChild(r),setTimeout(()=>{r.remove()},3e3),t.trigger("updateActivity",n),t.trigger("setActivityDirtyState",!1),t.trigger("requestInspectorClose")}function O(e){if(!e||"undefined"==typeof console||!console?.error)return;const t=Array.isArray(e?.validationErrors)?e.validationErrors.filter(Boolean):[];console.error("[WhatsApp Message Activity] Journey validation failed.",e),t.length>0&&t.forEach(e=>{console.error("[WhatsApp Message Activity] Validation error:",e)})}function D(e){"undefined"!=typeof console&&console?.info&&console.info("[WhatsApp Message Activity] Journey validation succeeded.",e)}document.addEventListener("DOMContentLoaded",function(){d.forEach(e=>{const t=l(e);if(!t)return;const n="SELECT"===t.tagName||"datetime-local"===t.type?"change":"input";t.addEventListener(n,L)}),l("cancel")?.addEventListener("click",()=>{t.trigger("setActivityDirtyState",!1),t.trigger("requestInspectorClose")}),l("done")?.addEventListener("click",M),t.on("initActivity",S),t.on("requestedSchema",k),t.on("onActivityValidationFailed",O),t.on("notifyActivityValidationFailed",O),t.on("onActivityValidationSucceeded",D),t.on("notifyActivityValidationSucceeded",D),t.on("validateActivity",e=>{console.log("[WhatsApp Message Activity] validateActivity event received.",e)}),t.trigger("ready"),t.trigger("requestSchema"),t.trigger("requestInteraction")})})()})();